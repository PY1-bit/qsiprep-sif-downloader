name: Download QSIPrep SIF  # 方案 C：直链下载，不构建

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'QSIPrep 版本号（如 0.19.1）'
        required: true
        default: '0.19.1'

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: 下载官方 .sif（OSF 永久直链）
        run: |
          # OSF 直链模板：把版本号拼进去即可
          URL="https://osf.io/download/${{ github.event.inputs.version }}/?direct&mode=render"
          # 友好文件名
          FILE="qsiprep-${{ github.event.inputs.version }}.sif"
          # 一次性下载（支持断点续传）
          wget -c "$URL" -O "$FILE"
          # 校验文件存在
          ls -lh "$FILE"

      - name: 上传到 GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: qsiprep-${{ github.event.inputs.version }}-sif
          name: QSIPrep ${{ github.event.inputs.version }} SIF
          files: qsiprep-${{ github.event.inputs.version }}.sif
          token: ${{ secrets.GITHUB_TOKEN }}
