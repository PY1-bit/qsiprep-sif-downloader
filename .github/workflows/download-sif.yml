name: Download QSIPrep SIF

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'QSIPrep 版本号（目前仅 0.19.1 / 0.16.0 验证可用）'
        required: true
        default: '0.19.1'

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: 映射版本 → OSF ID
        id: map
        run: |
          case "${{ github.event.inputs.version }}" in
            0.19.1) OSF_ID=k7g2s ;;
            0.16.0) OSF_ID=k7g2p ;;
            *) echo "未收录该版本"; exit 1 ;;
          esac
          echo "OSF_ID=$OSF_ID" >> $GITHUB_OUTPUT

      - name: 下载官方 .sif（OSF 直链）
        run: |
          wget -c https://osf.io/${{ steps.map.outputs.OSF_ID }}/download \
               -O qsiprep-${{ github.event.inputs.version }}.sif
          ls -lh qsiprep-${{ github.event.inputs.version }}.sif

      - name: 上传到 GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: qsiprep-${{ github.event.inputs.version }}-sif
          name: QSIPrep ${{ github.event.inputs.version }} SIF
          files: qsiprep-${{ github.event.inputs.version }}.sif
          token: ${{ secrets.GITHUB_TOKEN }}
